{% extends "base2.html" %}

{% block title %}
Planora â€” Event: {{ event.title }}
{% endblock %}

{% block head %}
{# Remove any redundant stylesheets or inline styles here, as Tailwind should handle most styling #}
{% endblock %}

{% block body %}
{# The main content area of base2.html already provides 'my-6 mx-4 space-y-8 grow-[1]',
so we can just focus on the content within this block. #}

<!-- Main Event Title -->
<h1 class="text-4xl font-extrabold text-foreground mb-6 text-center md:text-left">
    {{ event.title }}
</h1>

<!-- Hero Image & Event Details Section -->
<section class="flex md:h-96 flex-col md:flex-row gap-6 mb-8 items-start">
    <!-- Hero Image Container -->
    <div class="w-full md:h-full md:w-2/3 lg:w-3/4 aspect-video rounded-lg overflow-hidden shadow-lg bg-cover bg-center bg-no-repeat"
        style="background-image: url('{{ event.image_url }}')" aria-label="Event Banner Image" role="img">
    </div>

    <!-- Event details card -->
    <div
        class="flex-1 md:h-full w-full px-0 md:px-6 space-y-4 rounded-lg /border /border-border /bg-secondary shadow-md text-foreground">
        {# Icons now using text-primary as per your recent home page update style #}
        <p class="flex items-center gap-2 text-lg"><span class="material-icons text-xl text-primary">event</span> Date:
            <span class="font-semibold">{{ event.date }}</span>
        </p>
        <p class="flex items-center gap-2 text-lg">
            <span class="material-icons text-xl text-primary">location_on</span>
            Location: <span class="font-semibold">{{ event.location or "TBA" }}</span>
        </p>
        <p class="flex items-center gap-2 text-lg">
            <span class="material-icons text-xl text-primary">group</span>
            Attendees: <span class="font-semibold">{{ event.attendees or 0 }}</span>
        </p>
        <p class="flex items-center gap-2 text-lg">
            <span class="material-icons text-xl text-primary">local_activity</span> Tickets Available:
            <span class="font-semibold">{{ event.tickets_available or 0 }}</span>
        </p>
        <p class="flex items-center gap-2 text-lg">
            <span class="material-icons text-xl text-primary">attach_money</span> Price:
            <span class="font-semibold">{{ "%.2f"|format(event.price) }}</span>
        </p>
        <p class="flex items-center gap-2 text-lg">
            <span class="material-icons text-xl text-primary">person_add_alt_1</span> Attending:
            <span class="font-semibold">
                {% if user_registered %}
                Yes
                {% else %}
                No
                {% endif %}
            </span>
        </p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <button type="button" id="share-event-btn" class="btn" title="Share this event">
                <span class="material-icons text-lg mr-2">share</span> Share
            </button>
            <form method="POST" class="space-y-4">
                <button type="submit" class="btn size-full {% if user_registered %}destructive{% endif %}" {% if not
                    user_registered and (event.tickets_available | int) <=0 %}disabled{% endif %}>
                    {% if user_registered %}
                    <span class="material-icons text-xl mr-2">person_remove</span> Leave
                    {% else %}
                    {% if (event.tickets_available | int) <= 0 %} <span class="material-icons text-xl mr-2">
                        cancel</span> Sold Out
                        {% else %}
                        <span class="material-icons text-xl mr-2">shopping_cart</span> RSVP
                        {% endif %}
                        {% endif %}
                </button>
            </form>
            {% if is_creator %}
            <a href="/events/{{ event.id }}/edit" class="btn">
                <span class="material-icons text-lg mr-2">edit</span> Edit
            </a>
            <form action="/events/{{ event.id }}/delete" method="POST">
                <button type="submit" class="btn destructive size-full">
                    <span class="material-icons text-lg mr-2">delete</span> Delete
                </button>
            </form>
            {% endif %}
        </div>
    </div>
</section>

<!-- Event Description Section -->
<h2 class="text-3xl font-bold text-foreground mb-4">Event Description</h2>
<div class="p-6 rounded-lg border border-border bg-secondary shadow-md mb-8">
    <p class="text-foreground leading-relaxed">{{ event.description }}</p>
</div>

<!-- Conditional Attendee List for Creators -->
{% if is_creator %}
<section class="mb-8">
    <h2 class="text-3xl font-bold text-foreground mb-4">Attendees</h2>
    <div class="relative w-full overflow-auto rounded-lg border border-border bg-secondary shadow-md">
        <table class="w-full caption-bottom text-sm">
            <thead class="[&_tr]:border-b">
                <tr
                    class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted text-muted-foreground">
                    <th class="h-12 px-4 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0 w-[50px]">S/N
                    </th>
                    <th class="h-12 px-4 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0">Name</th>
                    <th class="h-12 px-4 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0">Email</th>
                    {# REMOVED: Th for Actions column #}
                </tr>
            </thead>
            <tbody class="[&_tr:last-child]:border-0">
                {% if attendees %}
                {% for attendee in attendees %} {# Assume 'attendees' is a list of objects from backend #}
                <tr class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted text-foreground">
                    <td class="p-4 align-middle [&:has([role=checkbox])]:pr-0">{{ loop.index }}</td>
                    <td class="p-4 align-middle [&:has([role=checkbox])]:pr-0 font-medium">{{ attendee.name }}</td>
                    <td class="p-4 align-middle [&:has([role=checkbox])]:pr-0 text-muted-foreground">{{ attendee.email
                        }}</td>
                    {# REMOVED: Td for Actions button #}
                </tr>
                {% endfor %}
                {% else %}
                <tr class="text-foreground">
                    <td colspan="3" class="p-4 text-center text-muted-foreground">No attendees registered yet.</td>
                    {# Updated colspan to 3 #}
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</section>
{% endif %}

<script>
    // This script remains the same
    const shareBtn = document.getElementById('share-event-btn');
    shareBtn?.addEventListener('click', async () => {
        const shareData = {
            title: '{{ event.title|e }}',
            text: 'Check out this event on Planora: {{ event.title|e }}',
            url: window.location.href,
        };

        if (navigator.share) {
            try {
                await navigator.share(shareData);
                console.log('Event shared successfully');
            } catch (err) {
                if (err.name !== 'AbortError') {
                    alert('Sharing was cancelled or failed.');
                    console.error('Share failed:', err);
                }
            }
        } else {
            try {
                await navigator.clipboard.writeText(window.location.href);
                alert('Event URL copied to clipboard!');
            } catch (err) {
                alert('Share not supported on this browser or clipboard access denied.');
                console.error('Clipboard write failed:', err);
            }
        }
    });
</script>

{% endblock %}